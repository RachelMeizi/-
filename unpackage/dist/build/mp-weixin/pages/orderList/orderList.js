(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/orderList/orderList"],{"1ced":function(t,e,o){"use strict";o.r(e);var n=o("395f"),i=o("e257");for(var s in i)"default"!==s&&function(t){o.d(e,t,function(){return i[t]})}(s);o("5b7a");var r=o("2877"),a=Object(r["a"])(i["default"],n["a"],n["b"],!1,null,"10f46107",null);e["default"]=a.exports},"395f":function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement,o=(t._self._c,t.__map(t.list,function(e,o){var n=t._f("formatTime")(e.time),i=t._f("formatTime")(e.time),s=t._f("formatTime")(e.commentList.time);return{$orig:t.__get_orig(e),f0:n,f1:i,f2:s}}));t.$mp.data=Object.assign({},{$root:{l0:o}})},i=[];o.d(e,"a",function(){return n}),o.d(e,"b",function(){return i})},"422a":function(t,e,o){},"5b7a":function(t,e,o){"use strict";var n=o("422a"),i=o.n(n);i.a},"9e7a":function(t,e,o){"use strict";(function(t){function n(t){return r(t)||s(t)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function s(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function r(t){if(Array.isArray(t)){for(var e=0,o=new Array(t.length);e<t.length;e++)o[e]=t[e];return o}}function a(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(t){return Object.getOwnPropertyDescriptor(o,t).enumerable}))),n.forEach(function(e){u(t,e,o[e])})}return t}function u(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=function(){return o.e("components/empty").then(o.bind(null,"285e"))},l=function(){return o.e("components/whiteDraw").then(o.bind(null,"c2e1"))},d=function(){return o.e("components/neil-modal/neil-modal").then(o.bind(null,"81b5"))},h={components:{whiteDraw:l,neilModal:d,empty:c},data:function(){return{tabList:[],showPop:!1,showPopApply:!1,showPopFinish:!1,showPopApplyTicket:!1,ticketAddress:"",photoList:[],content:"",currentIndex:0,orderPrice:10,page:1,isShop:1,btnText:"接单",pages:"user",list:[]}},onLoad:function(t){this.isShop=this.$store.state.isShop,this.pages=t.pages,console.log(t,"options"),"user"==t.pages?this.tabList=["待接单","已接单","已完成","已评价","已挂账","已取消"]:this.tabList=["已接单","已完成","已评价","已取消","已挂账"]},onShow:function(){var e=this;this.list=[],console.log("当前位置的经度"),t.getLocation({type:"wgs84",success:function(t){e.lng=t.longitude,e.lat=t.latitude,e.getDataList(1),console.log("当前位置的经度："+t.longitude),console.log("当前位置的纬度："+t.latitude)}})},onReachBottom:function(){var t=this.page;t++,this.page=t,this.getDataList(t)},methods:{onOpenAddress:function(){var e=this;t.chooseLocation({success:function(t){console.log("位置名称："+t.name),console.log("详细地址："+t.address),console.log("纬度："+t.latitude),console.log("经度："+t.longitude),e.ticketAddress=t.address+"-"+t.name,e.ticketAddressInfo=t}})},formSumbitTicket:function(t){var e=this,o=a({},t.detail.value,{orderNum:this.OrderItem.orderNum,address:this.ticketAddress,lat:this.ticketAddressInfo.latitude,lng:this.ticketAddressInfo.longitude});console.log(o,"json"),this.$util.post("/xf/invoiceApply",JSON.stringify(o)).then(function(t){200==t.data.status?e.$util.success(t.data.msg):e.$util.fail(t.data.msg),e.showPopApplyTicket=!1})},onComment:function(e){t.navigateTo({url:"/pages/shopList/shopList?pages=publish&orderNum="+e.orderNum})},onApplyTicket:function(t){this.showPopApplyTicket=!0,this.OrderItem=t},getDataList:function(e){var o=this,i="";i="shop"==this.pages?"/worker/orderList?page="+e+"&status="+(this.currentIndex+3):"/xf/UserOrders?page="+e+"&status="+(this.currentIndex+1),this.$util.get(i).then(function(e){if(console.log(o.list.length,e.data.length,"this.list.length"),"shop"==o.pages){var i={name:"",headurl:"",content:"",rate:0,time:"0001-01-01T00:00:00Z"};e.data.forEach(function(t){t.commentList=i})}0==o.list.length&&e.data.length>0?o.list=e.data:o.list.length>0&&e.data.length>0?o.list=[].concat(n(o.list),n(e.data)):e.data.length<=0&&t.showToast({title:"没有更多数据了",icon:"none"})})},onSubmitOrder:function(t){this.showPop=!0,this.OrderItem=t,console.log(t.orderNum,this.showPop,"onSubmitOrder")},onApplyOrder:function(t){this.showPopApply=!0,this.OrderItem=t,console.log(t.orderNum,this.showPopApply,"onApplyOrder")},drawChange:function(t){this.signArr=t},onPayOrder:function(t,e){var o=this,n=this;n.$util.get("/xf/OrderPay?orderNum="+t.orderNum).then(function(t){if(500==t.data.status)return n.$util.fail(t.data.msg);n.$util.get("/pay/PayOrder?orderNum="+t.data.orderNum).then(function(t){n.$wxPay(t.data),o.getDataList(1)})})},applyBtnOrder:function(){var e=this,o={orderNum:this.OrderItem.orderNum,signArr:JSON.stringify(this.signArr)};console.log(o),""!=o.orderNum&&void 0!=o.signArr?(this.$util.post("/xf/ChargeToTheRoom",o).then(function(t){200==t.data.status?(e.$util.success(t.data.msg),e.getDataList(1)):e.$util.fail(t.data.msg)}),this.showPopApply=!1,console.log(o,"需要挂账提交的数据")):t.showToast({title:"订单号和签名必填信息不能为空",duration:1500,icon:"none",success:function(){e.showPopApply=!1}})},onFinishOrder:function(e,o){var n=this;t.showModal({title:"提示",content:"是否上传服务内容照片及工时量或者材料等描述?",success:function(t){if(t.confirm)n.showPopFinish=!0,n.photoList=[],n.OrderItem=e,n.OrderItem.index=o;else{var i={orderNum:e.orderNum,type:2,content:"",imgList:[]};n.funFinshOrder(i,o)}}})},onContentOrder:function(){var t={orderId:this.OrderItem.id,orderNum:this.OrderItem.orderNum,type:2,content:this.content,imgList:this.photoList||[]};this.funFinshOrder(t,this.OrderItem.index),this.showPopFinish=!1},funFinshOrder:function(t,e){var o=this;this.$util.post("/xf/ActionOrder",JSON.stringify(t)).then(function(t){200==t.data.status?(o.$util.success(t.data.msg),o.list.splice(e,1)):o.$util.fail(t.data.msg)})},getContent:function(t){this.content=t.detail.value},delImg:function(t){this.photoList.splice(t,1)},photo:function(){var e=this;t.chooseImage({count:6,sizeType:["original","compressed"],sourceType:["camera","album"],success:function(t){var o;console.log(t.tempFilePaths),e.photoList=e.photoList.concat(t.tempFilePaths),console.log(e.photoList,"this.photoList");var n=t.tempFilePaths.map(function(t,o){return e.$util.upload("/up/upload",t)});Promise.all(n).then(function(t){e.array=t.map(function(t){var e=JSON.parse(JSON.stringify(t.data).replace(/name/g,"src"));return o=JSON.parse(e),o}),e.photoList=e.array,console.log(e.photoList,"411111111"),e.photoList.length>=6&&(e.photoList=e.photoList.slice(0,6))})}})},onUserCancelOrder:function(e,o){var n=this,i="/worker/userRemoveOrder?orderNum="+e.orderNum;t.showModal({title:"提示",content:"确定要取消吗?",success:function(t){t.confirm&&n.$util.get(i).then(function(t){200==t.data.status?(n.$util.success(t.data.msg),n.list.splice(o,1)):n.$util.fail(t.data.msg)})}})},onShopCancelOrder:function(e,o){var n=this,i=this;console.log("onCancelOrder");var s={orderNum:e.orderNum,type:1};t.showModal({title:"提示",content:"确定要取消吗?",success:function(t){t.confirm&&i.$util.post("/xf/ActionOrder",JSON.stringify(s)).then(function(t){200==t.data.status?(i.$util.success(t.data.msg),i.list.splice(o,1)):n.$util.fail(t.data.msg)})}})},closeModal:function(t){this.showPop=!1},bindBtn:function(t){var e=this;"confirm"==t&&(console.log(this.orderPrice,this.OrderItem.orderNum,"订单价格+订单号"),this.$util.get("/worker/upOrderPrice?orderNum="+this.OrderItem.orderNum+"&price="+this.orderPrice).then(function(t){200==t.data.status?(e.$util.success(t.data.msg),e.list=[],e.OrderItem.price=e.orderPrice,e.getDataList(1)):e.$util.fail(t.data.msg)})),this.showPop=!1},onDetail:function(e){var o="";o="shop"==this.pages?"shop":"user",t.navigateTo({url:"/pages/detail/detail?id="+e.id+"&pages="+o+"&orderNum="+e.orderNum+"&status="+this.currentIndex})},onChangetab:function(t){this.currentIndex=t,console.log(this.currentIndex,"index"),this.list=[],this.getDataList(1)},onGoPublish:function(){t.navigateTo({url:"/pages/publish/publish"})}}};e.default=h}).call(this,o("543d")["default"])},d921:function(t,e,o){"use strict";(function(t){o("2b29"),o("921b");n(o("66fd"));var e=n(o("1ced"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},e257:function(t,e,o){"use strict";o.r(e);var n=o("9e7a"),i=o.n(n);for(var s in n)"default"!==s&&function(t){o.d(e,t,function(){return n[t]})}(s);e["default"]=i.a}},[["d921","common/runtime","common/vendor"]]]);